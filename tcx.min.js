!function(o,r){var i="_tcx_token";function e(t,e){var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function s(){var t=document.cookie.split(";"),o=!1;return t.forEach(function(t,e){for(;" "==t.charAt(0);)t=t.substring(1,t.length);var n=t.split("=");i===n[0]&&(o=n[1])}),o||(a({}),o=r.AES.encrypt(JSON.stringify({}),r.enc.Base64.stringify(r.enc.Utf8.parse("tcx-js")))),JSON.parse(r.AES.decrypt(o,r.enc.Base64.stringify(r.enc.Utf8.parse("tcx-js"))).toString(r.enc.Utf8))}function a(t){var e=new Date;e.setHours(e.getHours()+2),document.cookie=i+"="+r.AES.encrypt(JSON.stringify(t),r.enc.Base64.stringify(r.enc.Utf8.parse("tcx-js")))+";expires="+e.toGMTString()+";path=/"}this.TCX=function(){var t={url:"",auth:"param",app_id:"",secret_key:"",public_key:"",master_key:""};this.options=e(t,arguments[0]&&"object"==typeof arguments[0]?arguments[0]:{})},TCX.prototype.AUTH_DEFAULT="none",TCX.prototype.AUTH_PARAM="param",TCX.prototype.AUTH_TIME="time",TCX.prototype.getAuth=function(){return this.options.auth},TCX.prototype.getAppID=function(){return this.options.app_id},TCX.prototype.getAppPass=function(t){var n="",e=function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz0123456789",n=0;n<16;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}();switch(this.options.auth){case"param":Object.keys(t).sort().forEach(function(t,e){console.log(t),n+=t+"="+e+"&"}),n.replace(/^&+|&+$/g,"");break;case"time":n=void 0!==t&&t.hasOwnProperty("tcx_datetime")?t.tcx_datetime:this.getTime()}var o=r.enc.Hex.stringify(r.SHA1(n+this.options.public_key+e));return o=r.enc.Utf8.parse(o+":"+e),o=r.enc.Base64.stringify(o)},TCX.prototype.getToken=function(e){if(void 0===s().token){var t;if("time"===this.options.auth){var n=this.getTime();t={app_id:this.getAppID(),app_pass:this.getAppPass({tcx_datetime:n}),tcx_datetime:n}}else t={app_id:this.getAppID(),app_pass:this.getAppPass({})};o.ajax({url:this.options.url+"/tcx/authorize",type:"POST",data:JSON.stringify(t),dataType:"json",contentType:"application/json",success:function(t){1===t.status?(a(t.data),e(t.data.token)):e(!1)},error:function(){e(!1)}})}else e(s().token)},TCX.prototype.refreshToken=function(e){void 0===s().token?this.getToken(e):s().refresh?o.ajax({url:this.options.url+"/tcx/reauthorize",type:"POST",data:JSON.stringify({app_id:this.getAppID(),token:s().refresh}),contentType:"application/json",dataType:"json",success:function(t){1===t.status?(a(t.data),e(t.data.token)):e(!1)},error:function(){e(!1)}}):e(s().token)},TCX.prototype.clearToken=function(){a({})},TCX.prototype.getMasterToken=function(){var t=r.enc.Utf8.parse(this.options.master_key);return r.enc.Base64.stringify(t)},TCX.prototype.getTime=function(){return moment().format("YYYYMMDDHHmmss")},TCX.prototype.appendTime=function(t){return t.tcx_datetime=this.getTime(),t}}(jQuery,CryptoJS);